{{ block title }}
    Phase 3
{{ endblock }}
{{ block content }}

<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Receiver</title>
<style>
  body {
    display: flex;
    justify-content: center;
    align-items: center;
    text-align: center;
    margin: 0;
    background-color: #f5f5f5;
  }

  #challengeSection {
    display: none;
  }

  .container {
    background-color: #ffffff;
    border-radius: 10px;
    padding: 20px;
    box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.2);
    width: 80%;
  }

  .row {
    display: flex;
    align-items: center;
    margin-bottom: 20px;
    padding: 10px;
    border: 1px solid #ccc;
    border-radius: 5px;
  }

  .column {
    flex: 1;
    align-items: left;
    padding: 10px;
  }

  .image {
    max-width: 100%;
  }

  label {
    display: block;
    margin-bottom: 5px;
  }

  input[type="text"], input[type="radio"] {
    margin-bottom: 10px;
    max-width: 100%;

  }

  table {
    width: 100%;
    border-collapse: collapse;
    table-layout: fixed;
  }

  table tr:nth-last-child(2) {
    border-bottom: 2px double black;
  }

  th, td {
    border: 1px solid black;
    padding: 8px;
    text-align: left;
  }

  .hidden {
    display: none;
  }

  .ball {
    margin-top: 5px;
    width: 30px;
    height: 30px;
    border-radius: 50%;
    background-color: {{ signalcss }};
    display: none;
  }

  .hiddens {
    display: none;
  }

</style>
<script>
function toggleSignalVisibility() {
    var textDiv3 = document.getElementById("textDiv3");
    var radioDiv = document.getElementById("txtrow");
    var ballDiv = document.getElementById("ball");
    liveSend(1);

    textDiv3.style.display = textDiv3.style.display === "none" ? "block" : "none";
    radioDiv.style.display = radioDiv.style.display === "none" ? "block" : "none";
    document.getElementById("txtrow").style.display = "none";
  }


  function toggleTextVisibility() {
    var textDiv2 = document.getElementById("textDiv2");
    var radioDiv = document.getElementById("btnrow");

    liveSend(2);

    textDiv2.style.display = textDiv2.style.display === "none" ? "block" : "none";
    radioDiv.style.display = radioDiv.style.display === "none" ? "block" : "none";
    document.getElementById("btnrow").style.display = "none";
  }


function generateRandomSequence() {
    var characters = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
    var sequence = "";

    for (var i = 0; i < 5; i++) {
      var randomIndex = Math.floor(Math.random() * characters.length);
      sequence += characters.charAt(randomIndex);
    }

    return sequence;
  }

  function startChallenge(index) {
    var sequence = generateRandomSequence();
    var challengeSection = document.getElementById("challengeSection");
    var challengeText = document.getElementById("challengeText");
    var inputField = document.getElementById("inputField");
    var submitButton = document.getElementById("submitButton");

    if (index === 1) {
      liveSend(3);
    }
    if (index === 2) {
      liveSend(4);
    }

    alert("To see the desired additional information, please solve the CAPTCHA below!");
    challengeText.textContent = sequence;
    inputField.value = "";
    challengeSection.style.display = "block";
    submitButton.onclick = function () {
      checkAnswer(sequence, index);
    };
  }

  function checkAnswer(expectedSequence, index) {
    var inputField = document.getElementById("inputField");
    var userSequence = inputField.value;

    if (userSequence.toUpperCase() === expectedSequence.split('').reverse().join('')) {
      alert("Correct! The desired additional information is displayed.");
      var challengeSection = document.getElementById("challengeSection");
      challengeSection.style.display = "none";
      if (index === 1) {
        var moreData = document.getElementById("toggleSignalButton");
        var moreNarr = document.getElementById("txtcol");
        moreData.style.display = "none";
        moreNarr.style.display = "none";
        toggleSignalVisibility();
      }
      if (index === 2) {
        var moreTextButton = document.getElementById("toggleTextButton");
        var moreData = document.getElementById("toggleSignalButton");
        moreTextButton.style.display = "none";
        moreData.style.display = "none";
        toggleTextVisibility();
      }
    } else {
      var clicks = document.getElementById("mistakes");
      clicks.innerHTML = parseInt(clicks.innerHTML) +1;
      alert("That was unfortunately false.");
    }
  }
</script>
</head>
<body>
  <div class="container">
    <div class="row">
      <div class="column">
      With what probability do you think that there is a 1 behind the question mark? Please enter this probability into the text field below.
      </div>
    </div>
    <div id="mistakes" class="hiddens">0</div>
    <div class="row">
      <div class="column">
        <table>
          <thead>
            <tr>
              <th>Y</th>
              <th>E1</th>
              <th>E2</th>
              <th>E3</th>
            </tr>
          </thead>
          <tbody>
            <tr class="hidden">
              <td>{{ hb.0 }}</td>
              <td>{{ nb_1.0 }}</td>
              <td>{{ nb_2.0 }}</td>
              <td>{{ nb_3.0 }}</td>
            </tr>
            <tr class="hidden">
              <td>{{ hb.1 }}</td>
              <td>{{ nb_1.1 }}</td>
              <td>{{ nb_2.1 }}</td>
              <td>{{ nb_3.1 }}</td>
            </tr>
            <tr class="hidden">
              <td>{{ hb.2 }}</td>
              <td>{{ nb_1.2 }}</td>
              <td>{{ nb_2.2 }}</td>
              <td>{{ nb_3.2 }}</td>
            </tr>
            <tr class="hidden">
              <td>{{ hb.3 }}</td>
              <td>{{ nb_1.3 }}</td>
              <td>{{ nb_2.3 }}</td>
              <td>{{ nb_3.3 }}</td>
            </tr>
            <tr>
              <td>{{ hb.4 }}</td>
              <td>{{ nb_1.4 }}</td>
              <td>{{ nb_2.4 }}</td>
              <td>{{ nb_3.4 }}</td>
            </tr>
            <tr>
              <td>{{ hb.5 }}</td>
              <td>{{ nb_1.5 }}</td>
              <td>{{ nb_2.5 }}</td>
              <td>{{ nb_3.5 }}</td>
            </tr>
            <tr>
              <td>{{ hb.6 }}</td>
              <td>{{ nb_1.6 }}</td>
              <td>{{ nb_2.6 }}</td>
              <td>{{ nb_3.6 }}</td>
            </tr>
            <tr>
              <td>{{ hb.7 }}</td>
              <td>{{ nb_1.7 }}</td>
              <td>{{ nb_2.7 }}</td>
              <td>{{ nb_3.7 }}</td>
            </tr>
            <tr>
              <td>{{ hb.8 }}</td>
              <td>{{ nb_1.8 }}</td>
              <td>{{ nb_2.8 }}</td>
              <td>{{ nb_3.8 }}</td>
            </tr>
            <tr>
              <td>{{ hb.9 }}</td>
              <td>{{ nb_1.9 }}</td>
              <td>{{ nb_2.9 }}</td>
              <td>{{ nb_3.9 }}</td>
            </tr>
            <tr>
              <td>{{ hb.10 }}</td>
              <td>{{ nb_1.10 }}</td>
              <td>{{ nb_2.10 }}</td>
              <td>{{ nb_3.10 }}</td>
            </tr>
            <tr>
              <td>{{ hb.11 }}</td>
              <td>{{ nb_1.11 }}</td>
              <td>{{ nb_2.11 }}</td>
              <td>{{ nb_3.11 }}</td>
            </tr>
            <tr>
              <td><b style='color:red;'>?</b></td>
              <td>{{ nb_1.12 }}</td>
              <td>{{ nb_2.12 }}</td>
              <td>{{ nb_3.12 }}</td>
            </tr>
          </tbody>
        </table>

      </div>
    </div>
    <div class="row" id="btnrow">
      <div class="column">
        <button type="button" id="toggleSignalButton" onclick="startChallenge(1)">See signal ({{ acc }} % accuracy)</button>
        <p id="textDiv3" style="display:none;"> Signal: The ball is {{ signal }} (accuracy: {{ acc }} %)
        </p>
      </div>
    </div>
    <div class="row" id="challengeSection">
      <h2>CAPTCHA: Please enter these letters in reverse order!</h2>
      <p id="challengeText"></p>
      <input type="text" id="inputField">
      <button type = "button" id="submitButton">Check answer</button>
    </div>
    <div class="row" id="txtrow">
      <div class="column" id="txtcol">
        <div class="text">
          <button type="button" id="toggleTextButton" onclick="startChallenge(2)">See a hint</button>
          <p id="textDiv2" style="display: none;"> {{ keyword }} </p>
        </div>
      </div>
    </div>
    <div class="row">
      <div class="column">
          <label for="assessment">What do you think is the probability that there is a 1 behind the question mark (?)?
          </label>
          <input type="text" id="assessment" name="assessment"> %.
              {{ formfield_errors 'assessment' }}
      </div>
    </div>

<button class="otree-btn-next btn btn-primary">Next</button>

  </div>
</body>
{{  endblock  }}